<!DOCTYPE html>
<head>
  <title>HTML5 Games Workshop - Jumps</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="../../../../css/styles.css"/>
  <link rel="stylesheet" href="../../../../vendor/prism/prism.css"/>
  <script src="../../../../vendor/prism/prism.js"></script>
</head>
<body>
  <header class="main-header">
    <h1><a href="../../../..">HTML5 Games Workshop</a></h1>
  </header>
  <main>
    <article>
      <h1>Jumps</h1><p>Once we have gravity in place, making the main character to jump is almost trivial! If you remember physics class in school, a parabolic movement needs downward gravity applied to a body (we already did that in the previous step) and then some speed applied at the initial moment upwards so the body goes up and down in a <strong>parabola</strong>.</p>
<p>We will make the main character to jump when the player presses the up arrow key. We will also play a sound effect when this happens, since <strong>audio is crucial</strong> –even more than graphics– to provide feedback to the user!</p>
<h2 id="tasks">Tasks</h2>
<h3 id="detect-when-the-up-key-has-been-pressed">Detect when the up key has been pressed</h3>
<ol>
<li><p>Create an instance of <code>Phaser.Key</code> tied to the up arrow key. We will do that by modifying the <code>addKeys</code> call we already had in place in <code>init</code>:</p>
<pre><code class="lang-js"> PlayState.init = function () {
     // ...
     this.keys = this.game.input.keyboard.addKeys({
         left: Phaser.KeyCode.LEFT,
         right: Phaser.KeyCode.RIGHT,
         up: Phaser.KeyCode.UP // add this line
     });
 };
</code></pre>
</li>
<li><p>Instead checking for whether the key is pressed or not, we will listen for the &quot;on key down&quot; event and jump when it happens. In Phaser, events are called <strong>signals</strong> (they are instances of <a href="http://phaser.io/docs/2.6.2/Phaser.Signal.html"><code>Phaser.Signal</code></a>), and it&#39;s very easy to subscribe and unsubscribe from them.</p>
<pre><code class="lang-js"> this.keys.up.onDown.add(function () {
     this.hero.jump();
 }, this);
</code></pre>
<p> <small>Like many other functions in JavaScript, the extra argument after the callback is what will become the <code>this</code> context when the callback is executed.</small></p>
</li>
</ol>
<h3 id="implement-the-jump-method">Implement the jump method</h3>
<ol>
<li><p>Let&#39;s implement the <code>jump</code> method for <code>Hero</code>:</p>
<pre><code class="lang-js"> Hero.prototype.jump = function () {
     const JUMP_SPEED = 600;
     this.body.velocity.y = -JUMP_SPEED;
 };
</code></pre>
</li>
<li><p>Try it in the browser and check that the character can jump. You will find a bug, though: the character can jump mid-air! Although double jumps are not rare in platformer games, <em>infinite</em> jumps sure are. We will force the character to not jump mid-air.</p>
</li>
<li><p>We can check if a body is touching another body. Since platforms have physic bodies, we can know whether the main character is touching another body at the bottom or not. Modify the jump method so it looks like this:</p>
<pre><code class="lang-js"> Hero.prototype.jump = function () {
     const JUMP_SPEED = 600;
     let canJump = this.body.touching.down;

     if (canJump) {
         this.body.velocity.y = -JUMP_SPEED;
     }

     return canJump;
 };
</code></pre>
<p> <small>Note that we are also returning whether the character managed to jump or not… we will use this soon!</small></p>
</li>
</ol>
<h3 id="play-a-sound-effect-when-jumping">Play a sound effect when jumping</h3>
<ol>
<li><p>Sounds are also a game entity, but they obviously don&#39;t get rendered on the screen. But the process to handle them is similar to images. Let&#39;s start by loading the audio asset in <code>preload</code>:</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     // ...
     this.game.load.audio(&#39;sfx:jump&#39;, &#39;audio/jump.wav&#39;);
 };
</code></pre>
</li>
<li><p>Now let&#39;s create the audio entity, which will be an instance of <a href="http://phaser.io/docs/2.6.2/Phaser.Sound.html"><code>Phaser.Sound</code></a>. We can create these and add them to the game world with the <code>game.add</code> factory, as usual:</p>
<pre><code class="lang-js"> PlayState.create = function () {
     // create sound entities
     this.sfx = {
         jump: this.game.add.audio(&#39;sfx:jump&#39;)
     };
     // ...
 };
</code></pre>
</li>
<li><p>Last, we need to play the sound effect when a jump has been made. Remember how we had the <code>Hero.jump</code> method to return <code>true</code> or <code>false</code> depending on whether the jump was possible? We will make use of this now! Modify the listener for the arrow key so it looks like this:</p>
<pre><code class="lang-js"> PlayState.init = function () {
     // ...
     this.keys.up.onDown.add(function () {
         let didJump = this.hero.jump();
         if (didJump) {
             this.sfx.jump.play();
         }
     }, this);
 };
</code></pre>
</li>
</ol>
<p>Try it out in the browser. With a bit of skill, you should be able to jump to reach all the platforms in the level.</p>
<p><img src="/pizzicato-game.github.io/assets/platformer/hero_jump.gif" alt="Main character jumping"/></p>
<h2 id="checklist">Checklist</h2>
<ul>
<li>The character can jump!</li>
<li>The character <em>can not</em> jump mid-air.</li>
<li>A sound effect is played when jumping.</li>
</ul>

      <h2>Download</h2>
      <p>Are you stuck? Take a look at <a href="../../../../assets/platformer/steps/step08.js" download="">the source code</a> for this step.
      </p>
      <nav class="paginated-nav">
        <ul>
          <li class="previous">« Previous:&nbsp;<a href="../gravity">Gravity</a></li>
          <li class="next">Next:&nbsp;<a href="../pickable-coins">Pickable coins</a>&nbsp;»</li>
        </ul>
      </nav>
    </article>
  </main>
  <footer class="main-footer">
    <p>With love,<br/>the game dev fairies at <a href="https://mozilla.org">Mozilla</a>.</p>
  </footer>
</body>